<html lang="en"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Student Scheduler</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap');

  :root{
    --accent:#0078d4;
    --muted:#f3f3f3;
    --card:#ffffff;
    --text:#222;
    --danger:#ff4c4c;
    --ok:#28a745;
    --bg-overlay:rgba(0,0,0,0.5);
  }

  *{box-sizing:border-box;font-family:"Segoe UI",system-ui,-apple-system,SegoeUI,Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:linear-gradient(180deg,#f5f6f8 0,#f3f4f6 100%);padding:24px;display:flex;justify-content:center;}

  .wrap{width:100%;max-width:1150px;}

  .top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
  .title{display:flex;gap:12px;align-items:center;}
  h1{font-size:18px;margin:0;color:var(--text);font-weight:700;display:flex;align-items:center;gap:8px;}
  .controls{display:flex;gap:8px;align-items:center;}
  .btn{background:var(--accent);border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;}
  .btn.secondary{background:#fff;color:var(--accent);border:1px solid rgba(0,0,0,0.06);}

  .branch-info{
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    font-weight:bold;
    color:#333;
    text-align:right;
  }
  .branch-info hr{
    border:none;
    border-top:1px solid rgba(0,0,0,0.2);
    width:100%;
    margin:4px 0;
  }

  .calendar{background:var(--card);border-radius:12px;box-shadow:0 6px 22px rgba(0,0,0,0.08);overflow:hidden;}
  .header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(90deg,var(--accent),#006bb3);color:#fff;}
  .week-range{font-weight:600;}
  .nav{display:flex;gap:8px;align-items:center;}
  .nav .icon{background:rgba(255,255,255,0.12);border-radius:8px;padding:6px 8px;cursor:pointer;}

  .grid{display:grid;grid-template-columns:80px repeat(7,1fr);}
  .cell{border-bottom:1px solid #eee;border-right:1px solid #eee;padding:8px;min-height:46px;display:flex;align-items:flex-start;}
  .top-left{background:var(--muted);border-right:1px solid #eee;}
  .day-header{background:var(--muted);padding:10px 8px;text-align:center;font-weight:600;display:flex;flex-direction:column;align-items:center;gap:6px;}
  .day-name{font-size:13px;color:#333;}
  .day-date{font-size:12px;color:#666;}
  .link-btn{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:6px 8px;border-radius:8px;cursor:pointer;font-weight:700;}
  .link-btn.linked{background:#fff;color:var(--accent);border-color:rgba(0,0,0,0.08);box-shadow:0 2px 6px rgba(0,0,0,0.06);}

  .time-label{background:var(--muted);padding:8px 6px;font-size:12px;color:#444;text-align:center;}
  .slot{padding:6px;min-height:46px;position:relative;cursor:pointer;}

  .event{
    display:block;padding:6px;border-radius:6px;margin-bottom:6px;font-size:12px;color:#000;
    background:#e6f7ff !important;
    white-space:pre-line;
  }
  .event.absent{background:#ffd6d6 !important;}

  .dialog-back{position:fixed;inset:0;background:var(--bg-overlay);display:flex;align-items:center;justify-content:center;z-index:60;}
  .dialog{background:#fff;padding:20px;border-radius:10px;min-width:320px;box-shadow:0 8px 30px rgba(0,0,0,0.25);}

  .form-row{display:flex;gap:8px;margin:8px 0;flex-direction:column;}
  input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;font-size:13px;}
  textarea{min-height:80px;resize:vertical;}
  .row-right{display:flex;gap:8px;justify-content:flex-end;}

  .switch{position:relative;display:inline-block;width:40px;height:20px;}
  .switch input{opacity:0;width:0;height:0;}
  .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#28a745;transition:.4s;border-radius:34px;}
  .slider:before{position:absolute;content:"";height:14px;width:14px;left:3px;bottom:3px;background:white;transition:.4s;border-radius:50%;}
  .switch input:checked + .slider{background:#ff4c4c;}
  .switch input:checked + .slider:before{transform:translateX(20px);}

  @media (max-width:900px){
    .grid{grid-template-columns:60px repeat(7, minmax(80px,1fr));}
    .title h1{font-size:15px;}
  }
</style>
</head>
<body>

<div class="wrap">
  <div class="top">
    <div class="title">
      <h1><img src="logo.png" alt="Logo" style="height:24px;"> The Lebanese National High Conservatory Of Music<br>  Academic Year: 2025 - 2026</h1>
    </div>

    <div class="controls">
      <div class="branch-info">
        <span>Piano Professor: Ghada Nahouli</span>
        <hr>
        
      <span>Branch: Saida</span></div>
      <button class="btn secondary" id="clearStorage">Clear All</button>
    </div>
  </div>

  <div class="calendar">
    <div class="header">
      <div class="week-range" id="weekRange">Oct 13 — Oct 19</div>
      <div class="nav">
        <div class="icon" id="prevWeek">◀</div>
        <div class="icon" id="nextWeek">▶</div>
      </div>
    </div>
    <div class="grid" id="calendarGrid"><div class="cell top-left"></div><div class="day-header cell"><div class="day-name">Mon</div><div class="day-date">Oct 13, 2025</div><button class="link-btn">Link ✅</button></div><div class="day-header cell"><div class="day-name">Tue</div><div class="day-date">Oct 14, 2025</div><button class="link-btn">Link ✅</button></div><div class="day-header cell"><div class="day-name">Wed</div><div class="day-date">Oct 15, 2025</div><button class="link-btn">Link ✅</button></div><div class="day-header cell"><div class="day-name">Thu</div><div class="day-date">Oct 16, 2025</div><button class="link-btn">Link ✅</button></div><div class="day-header cell"><div class="day-name">Fri</div><div class="day-date">Oct 17, 2025</div><button class="link-btn">Link ✅</button></div><div class="day-header cell"><div class="day-name">Sat</div><div class="day-date">Oct 18, 2025</div><button class="link-btn">Link ✅</button></div><div class="day-header cell"><div class="day-name">Sun</div><div class="day-date">Oct 19, 2025</div><button class="link-btn">Link ✅</button></div><div class="time-label cell">9:00 AM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">9:30 AM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">10:00 AM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">10:30 AM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">11:00 AM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">11:30 AM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">12:00 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">12:30 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">1:00 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">1:30 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">2:00 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">2:30 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">3:00 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">3:30 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">4:00 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">4:30 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">5:00 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">5:30 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">6:00 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="time-label cell">6:30 PM</div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div><div class="slot cell"></div></div>
  </div>
</div>

<div id="dialogContainer" style="display:none;"></div>

<script>
const grid = document.getElementById('calendarGrid');
const weekRange = document.getElementById('weekRange');
const dialogContainer = document.getElementById('dialogContainer');

let currentDate = new Date(); currentDate.setHours(0,0,0,0);
const startHour = 9, endHour = 18, slotStep = 30;
const EV_KEY = 'studentEvents_v_local_v1';
const TMP_KEY = 'weekdayTemplates_v_local_v1';
const LINK_KEY = 'linkedWeekdays_v_local_v1';

let events = {};
let templates = {};
let linkedWeekdays = {};

try { events = JSON.parse(localStorage.getItem(EV_KEY)) || {}; } catch(e){ events = {}; }
try { templates = JSON.parse(localStorage.getItem(TMP_KEY)) || {}; } catch(e){ templates = {}; }
try { linkedWeekdays = JSON.parse(localStorage.getItem(LINK_KEY)) || {}; } catch(e){ linkedWeekdays = {}; }

function saveAll(){
  try{
    localStorage.setItem(EV_KEY, JSON.stringify(events));
    localStorage.setItem(TMP_KEY, JSON.stringify(templates));
    localStorage.setItem(LINK_KEY, JSON.stringify(linkedWeekdays));
  }catch(e){console.error(e);}
}

function isoDate(d){
  return `${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getDate().toString().padStart(2,'0')}`;
}
function formatTimeAMPM(h,m){
  const ampm = h>=12?'PM':'AM';
  const hr = h>12?h-12:(h===0?12:h);
  return `${hr}:${m.toString().padStart(2,'0')} ${ampm}`;
}
function getWeekStart(date){
  const d=new Date(date);
  const diff = d.getDay()===0 ? -6 : 1 - d.getDay();
  d.setDate(d.getDate()+diff);
  d.setHours(0,0,0,0);
  return d;
}

function renderCalendar(date){
  grid.innerHTML='';
  const startOfWeek=getWeekStart(date);
  const days=[];
  for(let i=0;i<7;i++){const dd=new Date(startOfWeek);dd.setDate(dd.getDate()+i);days.push(dd);}

  const tl=document.createElement('div');tl.className='cell top-left';grid.appendChild(tl);

  days.forEach(d=>{
    const cell=document.createElement('div');cell.className='day-header cell';
    const weekdayIndex=d.getDay();
    const dayName=d.toLocaleDateString(undefined,{weekday:'short'});
    const dateStr=d.toLocaleDateString(undefined,{month:'short',day:'numeric',year:'numeric'}); // YEAR ADDED HERE
    const name=document.createElement('div');name.className='day-name';name.textContent=dayName;
    const dt=document.createElement('div');dt.className='day-date';dt.textContent=dateStr;
    const btn=document.createElement('button');btn.className='link-btn';
    if(linkedWeekdays[weekdayIndex])btn.classList.add('linked');
    btn.textContent=linkedWeekdays[weekdayIndex]?'🔗 Linked':'Link ✅';
    btn.addEventListener('click',e=>{e.stopPropagation();toggleLinkForWeekday(weekdayIndex,d);});
    cell.appendChild(name);cell.appendChild(dt);cell.appendChild(btn);grid.appendChild(cell);
  });

  for(let h=startHour;h<=endHour;h++){
    for(let m=0;m<60;m+=slotStep){
      const tlbl=document.createElement('div');tlbl.className='time-label cell';tlbl.textContent=formatTimeAMPM(h,m);grid.appendChild(tlbl);
      days.forEach(d=>{
        const slot=document.createElement('div');slot.className='slot cell';
        const dateKey=isoDate(d);const timeKey=formatTimeAMPM(h,m);const wkday=d.getDay();const fullKey=`${dateKey}-${timeKey}`;
        if(!Array.isArray(events[fullKey]))events[fullKey]=[];
        let shownEvents=[];
        if(linkedWeekdays[wkday] && templates[wkday] && Array.isArray(templates[wkday][timeKey])){
          templates[wkday][timeKey].forEach(tpl=>{
            let existing=events[fullKey].find(e=>e.student===tpl.student);
            if(!existing){existing={student:tpl.student,grade:tpl.grade||'',note:'',absent:false};events[fullKey].push(existing);}
            shownEvents.push(existing);
          });
        }else shownEvents=[...events[fullKey]];
        shownEvents.forEach((ev,idx)=>{
          const evEl=document.createElement('span');
          evEl.className='event'+(ev.absent?' absent':'');
          const gradePart=ev.grade?(' · '+ev.grade):'';
          evEl.textContent=`${ev.student}${gradePart}`+(ev.note?`\n${ev.note}`:'');
          evEl.addEventListener('click',e=>{e.stopPropagation();openEditDialog({date:d,time:timeKey,index:idx});});
          slot.appendChild(evEl);
        });
        slot.addEventListener('click',()=>openAddDialog({date:d,time:timeKey}));
        grid.appendChild(slot);
      });
    }
  }

  const start=days[0],end=days[6];
  weekRange.textContent=`${start.toLocaleDateString(undefined,{month:'short',day:'numeric'})} — ${end.toLocaleDateString(undefined,{month:'short',day:'numeric',year:(start.getFullYear()!==end.getFullYear())?'numeric':undefined})}`;
  saveAll();
}

function toggleLinkForWeekday(weekdayIndex, referenceDate){
  const wasLinked=!!linkedWeekdays[weekdayIndex];
  if(!wasLinked){
    const tpl={};
    for(let h=startHour;h<=endHour;h++){
      for(let m=0;m<60;m+=slotStep){
        const timeKey=formatTimeAMPM(h,m);
        const fullKey=`${isoDate(referenceDate)}-${timeKey}`;
        if(events[fullKey] && events[fullKey].length>0){
          tpl[timeKey]=events[fullKey].map(ev=>({student:ev.student,grade:ev.grade||''}));
        }
      }
    }
    templates[weekdayIndex]=tpl;
  }else delete templates[weekdayIndex];
  linkedWeekdays[weekdayIndex]=!wasLinked;
  renderCalendar(currentDate);
}

function openAddDialog({date,time}){
  showDialog(`Add Event — ${time}`,form=>{
    const student=form.student.value.trim();if(!student)return alert('Student name required');
    const grade=form.grade.value.trim();const note=form.note.value.trim();const absent=!!form.absent.checked;
    const fullKey=`${isoDate(date)}-${time}`;if(!events[fullKey])events[fullKey]=[];
    events[fullKey].push({student,grade,note,absent});
    renderCalendar(currentDate);
  });
}

function openEditDialog({date,time,index}){
  const fullKey=`${isoDate(date)}-${time}`;const ev=events[fullKey]&&events[fullKey][index];if(!ev)return;
  showDialog(`Edit Event — ${time}`,form=>{
    ev.student=form.student.value.trim();ev.grade=form.grade.value.trim();ev.note=form.note.value.trim();ev.absent=!!form.absent.checked;
    renderCalendar(currentDate);
  },()=>{events[fullKey].splice(index,1);renderCalendar(currentDate);},ev);
}

function showDialog(title,onSave,onDelete,data={}){
  dialogContainer.innerHTML='';dialogContainer.style.display='flex';
  const dlg=document.createElement('div');dlg.className='dialog-back';
  dlg.innerHTML=`
    <div class="dialog">
      <h2 style="margin-top:0;font-size:16px">${escapeHtml(title)}</h2>
      <form id="eventForm">
        <div class="form-row"><input type="text" name="student" placeholder="Student Name" value="${escapeHtml(data.student||'')}" /></div>
        <div class="form-row"><input type="text" name="grade" placeholder="Grade" value="${escapeHtml(data.grade||'')}" /></div>
        <div class="form-row" style="display:flex;align-items:center;gap:10px;">
          <label class="switch"><input type="checkbox" name="absent" ${data.absent?'checked':''}/><span class="slider"></span></label>
          <span style="font-weight:500;color:#333;">Absent</span>
        </div>
        <div class="form-row"><textarea name="note" placeholder="Note">${escapeHtml(data.note||'')}</textarea></div>
        <div class="row-right">
          ${onDelete?'<button type="button" class="btn secondary" id="deleteBtn">Delete</button>':''}
          <button type="submit" class="btn">Save</button>
          <button type="button" class="btn secondary" id="cancelBtn">Cancel</button>
        </div>
      </form>
    </div>`;
  dialogContainer.appendChild(dlg);
  const form=dlg.querySelector('#eventForm');
  form.onsubmit=e=>{e.preventDefault();onSave(form);closeDialog();};
  dlg.querySelector('#cancelBtn').onclick=closeDialog;
  if(onDelete)dlg.querySelector('#deleteBtn').onclick=()=>{onDelete();closeDialog();};
  dlg.addEventListener('click',e=>{if(e.target===dlg)closeDialog();});
}

function closeDialog(){dialogContainer.style.display='none';dialogContainer.innerHTML='';}
function escapeHtml(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

document.getElementById('clearStorage').onclick=()=>{if(confirm('Clear all saved events?')){events={};templates={};linkedWeekdays={};saveAll();renderCalendar(currentDate);}};
document.getElementById('prevWeek').onclick=()=>{currentDate.setDate(currentDate.getDate()-7);renderCalendar(currentDate);};
document.getElementById('nextWeek').onclick=()=>{currentDate.setDate(currentDate.getDate()+7);renderCalendar(currentDate);};

renderCalendar(currentDate);
</script>


</body></html>
